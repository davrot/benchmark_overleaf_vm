services:
  overleafserver:
    image: docker.io/sharelatex/sharelatex:feature-template-gallery
    container_name: overleafserver
    hostname: overleafserver
    restart: always
    volumes:
    - ./data:/var/lib/overleaf
    - /var/run/docker.sock:/var/run/docker.sock
    ports:
    - 80

    environment:
      GIT_BRIDGE_ENABLED: false
      GIT_BRIDGE_HOST: git-bridge
      GIT_BRIDGE_PORT: 8000

      REDIS_HOST: overleafredis
      REDIS_PORT: 6379

      OVERLEAF_REDIS_HOST: overleafredis

      V1_HISTORY_URL: http://127.0.0.1:3100/api

      OVERLEAF_MONGO_URL: mongodb://overleafmongo/sharelatex

      OVERLEAF_APP_NAME: ${OVERLEAF_APP_NAME}

      OVERLEAF_BEHIND_PROXY: true
      OVERLEAF_SECURE_COOKIE: true

      OVERLEAF_SITE_URL: ${OVERLEAF_SITE_URL}
      OVERLEAF_NAV_TITLE: ${OVERLEAF_NAV_TITLE}

      OVERLEAF_ADMIN_EMAIL: ${OVERLEAF_ADMIN_EMAIL}
      OVERLEAF_EMAIL_FROM_ADDRESS: ${OVERLEAF_EMAIL_FROM_ADDRESS}
      OVERLEAF_EMAIL_SMTP_HOST: ${OVERLEAF_EMAIL_SMTP_HOST}
      OVERLEAF_EMAIL_SMTP_PORT: ${OVERLEAF_EMAIL_SMTP_PORT}
      OVERLEAF_EMAIL_SMTP_SECURE: ${OVERLEAF_EMAIL_SMTP_SECURE}
      OVERLEAF_EMAIL_SMTP_IGNORE_TLS: ${OVERLEAF_EMAIL_SMTP_IGNORE_TLS}
      OVERLEAF_EMAIL_SMTP_TLS_REJECT_UNAUTH: "false"
      OVERLEAF_EMAIL_SMTP_LOGGER: true
      OVERLEAF_CUSTOM_EMAIL_FOOTER: ${OVERLEAF_CUSTOM_EMAIL_FOOTER}

      #################
      #   TEMPLATES   #
      #################

      ENABLE_CONVERSIONS: "true"

      OVERLEAF_TEMPLATE_GALLERY: "true"
      OVERLEAF_NON_ADMIN_CAN_PUBLISH_TEMPLATES: "true"
      OVERLEAF_TEMPLATE_CATEGORIES: "academic-journal book presentation poster cv homework bibliography calendar formal-letter report thesis newsletter"

      TEMPLATE_ACADEMIC_JOURNAL_NAME: "Journal articles"
      TEMPLATE_ACADEMIC_JOURNAL_DESCRIPTION: "Templates for academic journal submissions, including formats for major publishers and preprint servers."

      TEMPLATE_BIBLIOGRAPHY_NAME: "Bibliographies"
      TEMPLATE_BIBLIOGRAPHY_DESCRIPTION: "Styles for creating and managing bibliographies with BibTeX or BibLaTeX. Suitable for use in academic papers, theses, and reports."

      TEMPLATE_BOOK_NAME: "Books"
      TEMPLATE_BOOK_DESCRIPTION: "Templates for writing books or long-form documents, including chapter structuring, front matter, and indexing."

      TEMPLATE_CALENDAR_NAME: "Calendars"
      TEMPLATE_CALENDAR_DESCRIPTION: "Templates to create yearly, monthly, or weekly calendars. Useful for personal planners or event scheduling."

      TEMPLATE_CV_NAME: "CVs and résumés"
      TEMPLATE_CV_DESCRIPTION: "Templates for CVs and résumés with various formats for academic, industry, and creative positions."

      TEMPLATE_FORMAL_LETTER_NAME: "Formal letters"
      TEMPLATE_FORMAL_LETTER_DESCRIPTION: "Templates for professional letters, such as cover letters, recommendation letters, and official correspondence."

      TEMPLATE_HOMEWORK_NAME: "Assignments"
      TEMPLATE_HOMEWORK_DESCRIPTION: "Templates for homework, coursework, and problem sets. Designed to be clean and well-structured for students and educators."

      TEMPLATE_NEWSLETTER_NAME: "Newsletters"
      TEMPLATE_NEWSLETTER_DESCRIPTION: "Templates for creating newsletters with formats for academic, corporate, or community communications."

      TEMPLATE_POSTER_NAME: "Posters"
      TEMPLATE_POSTER_DESCRIPTION: "Templates for scientific and academic posters, typically used in conferences and research presentations."

      TEMPLATE_PRESENTATION_NAME: "Presentations"
      TEMPLATE_PRESENTATION_DESCRIPTION: "Templates for Beamer and other presentation formats, tailored for academic talks and lectures."

      TEMPLATE_REPORT_NAME: "Reports"
      TEMPLATE_REPORT_DESCRIPTION: "Templates for technical, lab, or project reports. Includes sections for figures, tables, and references."

      TEMPLATE_THESIS_NAME: "Theses"
      TEMPLATE_THESIS_DESCRIPTION: "Templates for writing theses and dissertations, following institutional formatting and citation guidelines."

      TEMPLATE_ALL_NAME: "All templates"
      TEMPLATE_ALL_DESCRIPTION: "Browse a collection of all available LaTeX templates, categorized by document type, style, and purpose."

    networks:
      - overleaf-network

    healthcheck:
      test: bash -c "curl  -fsI --connect-timeout 10 http://localhost || exit 1"
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 600s

networks:
  overleaf-network:
    external: true

